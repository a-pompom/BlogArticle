# 概要

ブログをVPSからGCPへ引っ越したので、思ったことなどをざっくりまとめてみます。

## 目次

[toc]

## TL;DR

GCPはいろんな機能を手軽に試せるので楽しい。各種クラウドサービスがどんな仕組みで動いているのか考えるようにすると、実務にも活かせる知識が身につくのかも。

## 前置き

やんごとなき事情で「GCP」という単語を目にする機会が増えました。GCPと仲良くなるためにとりあえず本を買って読んだりもしましたが、いまいち身についている感じがしませんでした。
それなら手を動かそうということで、VPSで動かしているブログをGCPへ引っ越すことにしました。

まあサクッと終わるっしょ〜と思っていたら案外ハマったので、引っ越してみてのあれこれとか感想をだらだら書くことにしました。

## やったこと

よくあるお作法に従い、ブログをWebブラウザからアクセスできる環境を整えました。
手順なんかは世にたくさん出回っていますが、備忘録がてらここでもざっくりやったことをまとめておきます。

* GCPのアカウントを作成
* GCEインスタンスを作成
* GCEインスタンスにSSH接続できるよう設定
    * 不正アクセスとかこわいのでSSHのポートを変更
* SSL証明書周りの処理を任せるためにロードバランサを作成 手順自体は単純だけれど、仕組みとか流れがいまいち掴めずけっこう詰まった
    * ロードバランサがHTTPSに関連した処理を担うことで、Webサーバに負荷を掛けないようにするのが目的
    * ロードバランサに固定IPを発行 インターネットからアクセスされるのはロードバランサなので、ほかから通信できるようIPが必要
* ロードバランサとGCEインスタンスを対応づけ
    * ロードバランサとGCEインスタンスはVPCの中で通信しており、通信を暗号化する必要がないのでHTTPプロトコルを利用
* DNSを設定
    * Cloud DNSでゾーンを作成
    * ドメインレジストラが参照しているネームサーバを上で作成したゾーンのNSレコードへ変更
    * Cloud DNSで設定したゾーンのAレコードをロードバランサの固定IPに設定
    * 以上の手順により、ブログのドメインがロードバランサの固定IPへ名前解決される
* GCEインスタンスでブログアプリケーションを構築
    * Dockerのおかげでサクッと構築できた ありがたい

こうして書いてみると、けっこう色々やってますね。3ヶ月は無料枠が使えるので、そのほかのサービスも試してみたいです。


## 思ったこと

やったことはお決まりの作業ですが、実際に手を動かしてみると、ぽつぽつと発見がありました。ここでは、そんな感想をつれづれと書き連ねてみます。

### コンソール

GCPのコンソールは項目がたくさんあって、最初はよく迷子になりました。
ですが、使った機能こそ少ないものの、触っているうちに少しずつ慣れてきました。なんかこうゲームのメニュー画面を触っているうちに手に馴染んでいく感じに近いなと思いました。

また、とりあえず手順通りに触ったら動いた、という認識では身につかないと思ったので、画面を触ったら裏で何が起こっているのかイメージするよう意識しました。
より具体的には、VPSに置き換えたり実際の通信を思い描いてみたり、何を目的とした操作なのか言葉にできるようにしました。
こうしておけば、実務で触ることになっても、課題を解決するためにどのサービスをどのように選べばよいのか、いい感じに意思決定できるようになるんじゃないかな、と思います。

### ロードバランサ周りのあれこれ

時折クラウドサービスに触れる機会はあったのですが、なんとなくロードバランサ周りには苦手意識がありました。
単一のインスタンスで負荷分散...？、なんでサーバ証明書をロードバランサに置くの...？など、わからないことが多かったです。

しかし、上で書いた通り、ロードバランサをつくる・ロードバランサに証明書を設定する意図を理解しないまま操作するわけにはいかないと思いました。
なんのためにこんなことをするんだろう、と疑問を抱いたときは、歴史を追ってみるのが定石です。ということで素敵なサイトが見つかったので、無事流れを理解することができました。

[参考](https://www.ctc-g.co.jp/report/column/lb_adc/vol01.html)

VPSを触るだけではあまり馴染みのないロードバランサですが、クラウドサービスに関わっていく上では、最低限全体像だけでもおさえておきたいです。

### 全般

クラウドサービスを使ってみることで、自分の知らないところ・知識が浅いところを知れました。
こう書くとなんだかネガティブな思いに見えますが、言い換えれば何を勉強すればさらに強くなれるのか知ることができたと言えます。

インフラ周りは弱いと自覚しているけれど、何から勉強したらいいか分かんないんだよなぁ...と思っているときにクラウドサービスを触ってみると、取っ掛かりが得られそうです。
ちょっとしたサーバを構築するだけでも、ロードバランサやDNS・証明書などたくさん知りたいことが増えました。

また、クラウドサービスは簡単に作成/破壊できるので、ちょっとログを試したい・サーバレスを使ってみたいなど、今後経験を積みたいなと思っているところの足がかかりにも良さそうです。


## まとめ

軽い気持ちではじめた引っ越し作業ですが、やってみるとたくさん発見・学び・課題があって面白かったです。
これを機にクラウドサービスとも仲良くなっていきたいですね。
